<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/mainHead', { title: 'DataAPI Tools' }) %>

</head>




<body class="fixed-nav sticky-footer bg-light sidenav-toggled" id="page-top">

<%- include('partials/nav') %>


<div class="content-wrapper">
    <div class="container-fluid pt-4 mt-5">
        
        <!-- Quick Access Tools Card -->
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <i class="fa fa-tools"></i> Quick Access Tools
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <a href="/storage-tool" class="btn btn-outline-primary w-100 p-4">
                                    <i class="fa fa-hdd fa-2x mb-2"></i><br>
                                    <strong>Storage Scanner</strong><br>
                                    <small>Scan and index files from directories</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="/file-browser" class="btn btn-outline-success w-100 p-4">
                                    <i class="fa fa-folder-open fa-2x mb-2"></i><br>
                                    <strong>File Browser</strong><br>
                                    <small>Browse and search indexed files</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="/databases" class="btn btn-outline-info w-100 p-4">
                                    <i class="fa fa-database fa-2x mb-2"></i><br>
                                    <strong>Database Viewer</strong><br>
                                    <small>Browse and manage database collections</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="http://192.168.2.33:3080/n8n-control.html" target="_blank" class="btn btn-outline-warning w-100 p-4">
                                    <i class="fa fa-bolt fa-2x mb-2"></i><br>
                                    <strong>n8n Operations</strong><br>
                                    <small>Manage workflows & webhooks (AgentX)</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="http://192.168.2.33:3080/" target="_blank" class="btn btn-outline-primary w-100 p-4">
                                    <i class="fa fa-robot fa-2x mb-2"></i><br>
                                    <strong>AgentX Chat</strong><br>
                                    <small>AI assistant with Ollama models</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="/admin-feed" class="btn btn-outline-danger w-100 p-4">
                                    <i class="fa fa-chart-line fa-2x mb-2"></i><br>
                                    <strong>Admin Feed</strong><br>
                                    <small>Monitor events with AI assistant</small>
                                </a>
                            </div>
                            <div class="col-md-6 mb-3">
                                <a href="/users" class="btn btn-outline-secondary w-100 p-4">
                                    <i class="fa fa-users fa-2x mb-2"></i><br>
                                    <strong>User Management</strong><br>
                                    <small>Manage user accounts and settings</small>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danger Zone Card -->
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card border-danger">
                    <div class="card-header text-white bg-danger">Danger Zone</div>
                    <div class="card-body">
                        <!-- Delete User -->
                        <form action="/api/v1/user/deleteViaEmail" method="post" enctype="application/json" class="mb-3">
                            <label for="email_id" class="form-label">Delete User by Email</label>
                            <div class="input-group">
                                <input type="email" class="form-control" name="email" id="email_id" placeholder="Email address" required>
                                <button class="btn btn-outline-danger text-uppercase" type="submit">Delete User</button>
                            </div>
                        </form>
                        <hr>
                        <!-- Reset DB -->
                        <form action="/api/v1/resetDB">
                            <label class="form-label">Reset Database</label>
                            <div>
                                <button class="btn btn-danger w-100 text-uppercase" type="submit">!!!! Reset DB !!!!</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Device List Card -->
        <div class="row mb-4">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">Device List</div>
                    <div class="card-body text-left">
                        <small><div id="deviceList"></div></small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Device Selection Card -->
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card text-center">
                    <div class="card-header">Device Tools</div>
                    <div class="card-body d-flex justify-content-center align-items-center">
                        <select class="form-select w-auto" id="device_select"></select>
                        <button type="button" onClick="selectDevice()" class="btn btn-primary ms-2">Select Device</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Admin Debug Card -->
    <% const currentUser = (typeof user !== 'undefined' && user) ? user : null; %>
    <% if (currentUser && currentUser.isAdmin) { %>
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card border-primary">
                    <div class="card-header text-white bg-primary">Admin Debug</div>
                    <div class="card-body text-center">
                        <p>Trigger a test error (admin-only) to verify stack capture in the admin feed.</p>
                        <button id="triggerErrorBtn" class="btn btn-outline-light btn-danger">Trigger Test Error</button>
                        <div id="triggerResult" style="margin-top:12px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Latest Email Stats Card -->
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card">
                    <div class="card-header">Latest Email Stats</div>
                    <div class="card-body text-start">
                        <% if (latestEmailStat) { %>
                            <pre class="mb-0"><code><%= JSON.stringify(latestEmailStat, null, 2) %></code></pre>
                        <% } else { %>
                            <p class="mb-0">No email statistics are available yet.</p>
                        <% } %>
                    </div>
                    <a href="/admin-feed" class="btn btn-success ms-2">
                        <i class="fas fa-chart-line"></i> Access to mailEater
                    </a>
                </div>
            </div>
        </div>
        <% } %>

        <!-- Device Details Form Card -->
        <div class="row mb-4">
            <div class="col-sm-8 mx-auto">
                <div class="card">
                    <div class="card-body">
                        <form name="deviceForm" id="deviceForm">
                            <div class="mb-3">
                                <label for="type" class="form-label">Type</label>
                                <input type="text" class="form-control" id="type" name="type" placeholder="Enter name">
                            </div>
                            <div class="mb-3">
                                <label for="id" class="form-label">UID</label>
                                <input type="text" class="form-control" id="id" name="id">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lastBoot" class="form-label">Last boot</label>
                                    <input class="form-control" type="text" id="lastBoot" name="lastBoot" placeholder="2020/01/01 XX:XX:XX">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="connected" class="form-label">Connected</label>
                                    <input class="form-control" type="text" id="connected" name="connected" placeholder="true">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    // Pass server-side data to the window object so it can be accessed by the external module
    const userList = <%- JSON.stringify(users) %>;
    const deviceList = <%- JSON.stringify(devices) %>;
</script>
<script type="module" src="/js/tools.js"></script>


</body>
</html>
