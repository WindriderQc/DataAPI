<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/mainHead', { title: 'File Browser' }) %>
    <style>
        .file-browser-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: calc(100vh - 200px);
        }
        
        .search-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            color: white;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            transition: transform 0.2s;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
        }
        
        .file-item {
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .file-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .file-icon {
            width: 24px;
            height: 24px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .ext-img { background: #e3f2fd; color: #1976d2; }
        .ext-vid { background: #f3e5f5; color: #7b1fa2; }
        .ext-doc { background: #e8f5e8; color: #388e3c; }
        .ext-code { background: #fff3e0; color: #f57c00; }
        .ext-archive { background: #fce4ec; color: #c2185b; }
        .ext-other { background: #f5f5f5; color: #757575; }
        
        .breadcrumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            color: white;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
    </style>
</head>

<body class="fixed-nav sticky-footer bg-light sidenav-toggled" id="page-top">

<%- include('partials/nav') %>

<div class="content-wrapper">
    <div class="file-browser-container p-4">
        
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h2 class="text-white mb-0"><i class="fa fa-folder-open"></i> File Browser</h2>
                <p class="text-white-50">Browse and search your indexed files</p>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="row mb-4" id="statsSection">
            <div class="col-md-3">
                <div class="stats-card p-3 text-center">
                    <h3 class="text-primary mb-1" id="totalFiles">-</h3>
                    <small class="text-muted">Total Files</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card p-3 text-center">
                    <h3 class="text-success mb-1" id="totalSize">-</h3>
                    <small class="text-muted">Total Size</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card p-3 text-center">
                    <h3 class="text-info mb-1" id="totalExtensions">-</h3>
                    <small class="text-muted">File Types</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card p-3 text-center">
                    <h3 class="text-warning mb-1" id="totalDirectories">-</h3>
                    <small class="text-muted">Directories</small>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-section p-4 mb-4">
            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Search Files</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Search filenames or paths...">
                        <button class="btn btn-light" type="button" onclick="performSearch()">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label">File Type</label>
                    <select class="form-select" id="extensionFilter">
                        <option value="">All Types</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Sort By</label>
                    <select class="form-select" id="sortBy">
                        <option value="filename">Name</option>
                        <option value="size">Size</option>
                        <option value="mtime">Modified</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Order</label>
                    <select class="form-select" id="sortDir">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Per Page</label>
                    <select class="form-select" id="limitSelect">
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-12">
                    <button class="btn btn-light me-2" onclick="browseFiles()">
                        <i class="fa fa-refresh"></i> Refresh
                    </button>
                    <button class="btn btn-outline-light" onclick="clearFilters()">
                        <i class="fa fa-times"></i> Clear Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb p-3 mb-4" id="breadcrumbNav" style="display: none;">
            <ol class="breadcrumb mb-0" id="breadcrumbList">
            </ol>
        </nav>

        <!-- Results Section -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="resultsTitle">Files</h5>
                <div class="pagination-controls" id="paginationTop">
                    <!-- Pagination controls will be inserted here -->
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="filesTable">
                        <thead class="table-light">
                            <tr>
                                <th width="40"></th>
                                <th>Name</th>
                                <th width="100">Size</th>
                                <th width="150">Modified</th>
                                <th width="120">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filesTableBody">
                            <tr>
                                <td colspan="5" class="text-center p-4">
                                    <i class="fa fa-spinner fa-spin"></i> Loading files...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between align-items-center" id="resultsFooter">
                <span id="resultsInfo">Loading...</span>
                <div class="pagination-controls" id="paginationBottom">
                    <!-- Pagination controls will be inserted here -->
                </div>
            </div>
        </div>

    </div>
    <%- include('partials/footer') %>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="text-center text-white">
        <i class="fa fa-spinner fa-spin fa-3x mb-3"></i>
        <h4>Loading files...</h4>
    </div>
</div>

<!-- File Details Modal -->
<div class="modal fade" id="fileDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">File Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="fileDetailsBody">
                <!-- File details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- Bootstrap and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
<script type="module" src="/js/file-browser-simple.js"></script>

</body>
</html>